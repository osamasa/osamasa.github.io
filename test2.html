<!DOCTYPE HTML>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1"> 
    <title>page 1</title>
    <link rel="stylesheet" type="text/css" href="http://code.jquery.com/mobile/latest/jquery.mobile.min.css" />
    <script src="http://code.jquery.com/jquery-1.8.2.min.js"></script>
    <script type="text/javascript" src="jquery.json-2.4.min.js"></script>
    <script type="text/javascript" src="jstorage.js"></script>

    <script type="text/javascript" src="http://code.jquery.com/mobile/latest/jquery.mobile.min.js"></script>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
    
    <script type="text/javascript" charset="utf-8">
var UserCls = function(id,name,email) {
  this.id = id;
  this.name = name;
  this.email = email;
}

UserCls.prototype.setId = function(id) {
  this.id = id;
}

UserCls.prototype.setName = function(name) {
  this.name = name;
}

UserCls.prototype.setEmail = function(email) {
  this.email = email;
}

UserCls.prototype.getId = function() {
  return this.id;
}

UserCls.prototype.getName = function() {
  return this.name;
}

UserCls.prototype.getEmail = function() {
  return this.email;
}

UserCls.prototype.Save = function() {
  return { "id":this.id, "name":this.name, "email":this.email };
}

UserCls.prototype.Search = function( str ) {
  var re = new RegExp(str,"i");

  return (this.name.match(re) != null )|| (this.email.match(re) != null) ;
}

var UserCtrl = function() {
  this.users = new Array();
  this.storageKey = 'kflawjlkfejlkewja1kl3r8';
  this.lastid = 0;
}

UserCtrl.prototype.Search = function( str ) {
  var ret = new Array();
  for(var i = 0;i< this.users.length;i++) {
    if(this.users[i].Search( str ) == true) {
      ret.push(this.users[i]);
    }
  }
  return ret;
}

UserCtrl.prototype.SaveMembers = function() {
  var userhash = new Array();
  for(var i = 0;i< this.users.length;i++) {
    var tmp = this.users[i].Save();
    userhash.push(tmp);
  }
  $.jStorage.set(this.storageKey,$.toJSON( userhash ));
}

UserCtrl.prototype.addMember = function(id,name,email) {
  var tmp = new UserCls(id,name,email);
  if(this.lastid < id) {
    this.lastid = id;
  }
  this.users.push(tmp);
}

UserCtrl.prototype.newMember = function(name,email) {
  this.addMember(++this.lastid,name,email);
}

UserCtrl.prototype.RestoreMember = function() {
  var userhash = $.evalJSON($.jStorage.get(this.storageKey));
  this.users = undefined;
  this.users = new Array();
  for(var i = 0;i< userhash.length;i++) {
    this.addMember(userhash[i]['id'],userhash[i]['name'],userhash[i]['email']);
  }
}

UserCtrl.prototype.getUser = function( id ) {
  for(var i = 0;i< this.users.length;i++) {
    if(this.users[i].id == id) {
      return this.users[i];
    }
  }
}
var userctrl = new UserCtrl();

// userctrl.newMember('長田','');
// userctrl.newMember('志田','');
// userctrl.newMember('加藤','');
// userctrl.newMember('浅井','');

// userctrl.SaveMembers();

userctrl.RestoreMember();

var tmp = userctrl.Search('田');

for(var i=0;i<tmp.length;i++) {
  alert(tmp[i].getId());
  alert(tmp[i].getName());
}

    </script>
</head>
<body>
</body>
</html>

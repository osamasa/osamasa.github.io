<!DOCTYPE html>
<html>
<head>
<title>フォーム</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<link rel="stylesheet" href="jquery.mobile-1.4.0.min.css"/>
<link rel="stylesheet" href="custom.css"/>
<script src="jquery.js"></script>
<script src="jquery.mobile-1.4.0.min.js"></script>
<style type="text/css">
.containing-element .ui-slider-switch { width: 9em }
.ph-tap{}
.ph-tapped{ background: #6495ed }
</style>
<script type="text/javascript">

var MemberCls = function(id,name) {
    this.id = id;
    this.name = name;
    this.winnum = 0;
    this.losenum = 0;
}

MemberCls.prototype.isId = function(id) {
   return (this.id == id);
}

MemberCls.prototype.addWinNum = function(winteam) {
   var i = winteam.length;
   var ret = false;
   do {
     if(winteam[(winteam.length - i)] == this.id) {
       this.winnum++;
       ret = true;
       break;
     }
   } while(--i);
   return ret;
}

MemberCls.prototype.addLoseNum = function(loseteam) {
   var i = loseteam.length;
   var ret = false;
   do {
     if(loseteam[(loseteam.length - i)] == this.id) {
       this.losenum++;
       ret = true;
       break;
     }
   } while(--i);
   return ret;
}

MemberCls.prototype.getTextHead = function() {
  return this.id + ' : '  + this.name;
}

MemberCls.prototype.getTextEnd = function() {
  return this.name + ' さん ' + this.winnum + '勝';
}

var MemberCtrl = function() {
    this.members = null;
    this.dobules = false;
}

MemberCtrl.prototype.init = function(doubles_flg) {
    this.doubles = doubles_flg;
}

MemberCtrl.prototype.addMember = function(id,name) {
    if(this.members) {
      this.members.push(new MemberCls(id,name));
    } else {
      this.members = new Array();
      this.members[0] = new MemberCls(id,name);
    }
}

MemberCtrl.prototype.setResult = function(games)  {
   var i = games.length;
   var winteam='';
   var loseteam='';
   do {
      var h = games.length - i;
      if(games[h]['hantei']  == 1) {
         winteam = games[(games.length - i)]['team1'];
         loseteam = games[(games.length - i)]['team2'];
      } else if(games[(games.length - i)]['hantei']  == 2) {
         winteam = games[(games.length - i)]['team2'];
         loseteam = games[(games.length - i)]['team1'];
      } else {
         continue;
      }
      var winteams = this.splitTeams(winteam);
      var loseteams = this.splitTeams(loseteam);

      var l = this.members.length;
      do {
        this.members[(this.members.length - l)].addWinNum(winteams);
        this.members[(this.members.length - l)].addLoseNum(loseteams);
     } while(--l);
   } while(--i);
}

MemberCtrl.prototype.splitTeams = function(strTeam) {
  var tmp = undefined;
  if(this.doubles == true) {
    tmp = strTeam.split('_');
  } else {
    tmp = new Array();
    tmp[0] = strTeam;
  }
  return tmp;
}

MemberCtrl.prototype.getTextHead = function() {
  var i = this.members.length;
  var ret = '';
  do {
    ret += this.members[(this.members.length - i)].getTextHead() + '\n';
  } while (--i);
  return ret;
}

MemberCtrl.prototype.getTextEnd = function() {
  var i = this.members.length;
  var ret = '';
  do {
    ret += this.members[(this.members.length - i)].getTextEnd() + '\n';
  } while (--i);
  return ret;
}

var games = new Array(3);
var g_doubles_flg = true;
var g_num = 7;
var g_men = 1;

games[0] = new Array();
games[0]['shiai'] = 1;
games[0]['hantei'] = 1;
games[0]['team1'] = '1_2';
games[0]['team2'] = '3_4';

games[1] = new Array();
games[1]['shiai'] = 2;
games[1]['hantei'] = 1;
games[1]['team1'] = '4_5';
games[1]['team2'] = '6_7';

games[2] = new Array();
games[2]['shiai'] = 3;
games[2]['hantei'] = 1;
games[2]['team1'] = '1_3';
games[2]['team2'] = '5_7';

var memberctrl = new MemberCtrl();
memberctrl.init(g_doubles_flg);
memberctrl.addMember(1,'長田');
memberctrl.addMember(2,'鈴木');
memberctrl.addMember(3,'麻生');
memberctrl.addMember(4,'田中');
memberctrl.addMember(5,'矢部');
memberctrl.addMember(6,'加藤');
memberctrl.addMember(7,'樋口');

memberctrl.setResult(games);
alert(memberctrl.getTextHead());
alert(memberctrl.getTextEnd());
</script>
</head>
<body>
</body>
</html>

